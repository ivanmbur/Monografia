We are now going to develop the theory of Tomita-Takesaki following the approach of \cite{Duvenhage1999} and \cite{Rieffel1977}. This approach is appropriate for our purposes since it allows us to introduce the main objects of the theory, the Tomita-Takesaki theory, and the connection to KMS states, while avoiding unbounded operators (and therefore domain issues) by making use of real Hilbert spaces. The study of this theory is mathematically important due to its use in the classification of type III factors (and therefore physically important). As we will see, it is also physically important due to the interpretation we will give to $\Delta^{it}$ and the modular group in connection to KMS states.

For the remaining of the discussion I will assume knowledge of real Hilbert spaces, Borel functional calculus and polar decomposition. A quick account of this matters may be found in \cite{Duvenhage1999}. A more detailed exposition of Borel calculus and polar decompositions may be found in \cite{Rudin1991}.

\section{Operators of the Theory}

Let $\mathcal{K}$ and $\mathcal{L}$ be closed subspaces of a real Hilbert space $\mathcal{H}$ such that $\mathcal{K}\cap\mathcal{L}=\{0\}$ and $\mathcal{K}+\mathcal{L}$ is dense in $\mathcal{H}$. Define $P$ and $Q$ as the orthogonal projections on $\mathcal{K}$ and $\mathcal{L}$ respectively. Define $R=P+Q$ and let $JT=P-Q$ the polar decomposition of $P-Q$. $J$ is called the modular conjugation due to its role in the Tomita-Takesaki theorem. We have that $P,Q,$ and $T$ are positive. We will start by proving some basic facts about these operators which we will use throughout the development of the theory.

\begin{theorem}
\begin{enumerate}[(i)]
\item $R$ and $2-R$ are injective and $2\geq R \geq 0$;
\item $T=R^{1/2}(2-R)^{1/2}$ and is injective;
\item $J$ is self-adjoint, isometric, $J^2=1$ and is bijective;
\item $T$ commutes with $P,Q,R,$ and $J$;
\item $JP=(1-Q)J$, $JQ=(1-P)J$, and $JR=(2-R)J$.
\item $J\mathcal{K}=\mathcal{L}^\bot$
\end{enumerate}
\end{theorem}

\begin{proof}
\begin{enumerate}[(i)]
\item It is clear that the sum of positive operators is positive. Therefor $R\geq 0$. Moreover $1-P$ and $1-Q$ are also projections so that $2-R=(1-P)+(1-Q)\geq 0$. We conclude $2\geq R$. \\
Let $x\in\ker R$. Then
\begin{align}
\begin{split}
\|Px\|^2+\|Qx\|^2&=\langle Px,Px \rangle + \langle Qx,Qx\rangle = \langle x,P^*Px\rangle +\langle x, Q^*Qx\rangle \\
&=\langle x, P^2x\rangle + \langle x, Q^2x\rangle = \langle x,Px\rangle + \langle x,Qx\rangle \\
&=\langle x,Rx\rangle = 0
\end{split}
\end{align}
Therefore $x\in\ker P\cap\ker Q=\mathcal{K}^\bot\cap\mathcal{K}^\bot=(\mathcal{K}+\mathcal{L})^\bot=\mathcal{H}^\bot=\{0\}$ and we conclude $\ker R = {0}$, that is, $R$ is injective. Notice now that $\mathcal{K}^\bot$ and $\mathcal{L}^\bot$ satisfy the same properties that we imposed on $\mathcal{K}$ and $\mathcal{L}$ at the beginning. That is $\mathcal{K}^\bot\cap\mathcal{L}^\bot=\{0\}$ and
\begin{equation}
\overline{\mathcal{K}^\bot+\mathcal{L}^\bot}=(\mathcal{K}^\bot+\mathcal{L}^\bot)^{\bot\bot}=(\mathcal{K}^{\bot\bot}\cap\mathcal{L}^{\bot\bot})^\bot = (\mathcal{K}\cap\mathcal{L})^\bot=\{0\}^\bot = \mathcal{H}.
\end{equation}
Since $1-P$ and $1-Q$ are the projections on $\mathcal{K}^\bot$ and $\mathcal{L}^\bot$ we have by repeating the previous arguments that $2-R$ is injective.
\item We first note that 
\begin{align}
\begin{split}
T^2&=(P-Q)^*(P-Q)=(P-Q)(P-Q)=P-PQ-QP+Q \\
&=(P+Q)(2-P-Q)=R(2-R)=(R^{1/2})^2((2-R)^{1/2})^2 \\
&=(R^{1/2}(2-R)^{1/2})^2
\end{split}
\end{align}
Therefore, if $x\in \ker T$ the $x\in\ker T^2=\ker R(2-R)=\{0\}$. We conclude $T$ is injective. Since the product of positive elements is positive we have $T=R^{1/2}(2-R)^{1/2}$ by the uniqueness of the positive square root.
\item $J$ is an isometry on the orthogonal complement of
\begin{align}
\begin{split}
\ker J&=\ker (P-Q)\subseteq\ker(P-Q)^2=\ker(P-Q)^*(P-Q) \\
&=\ker T^2=\ker R(2-R)=\{0\}.
\end{split}
\end{align}
We conclude that $J$ is an isometry and is injective. $J^*=J$ and $J^2=1$ follows from $P-Q$ being self adjoint and the properties of the polar decomposition. Since $J^2=1$ we have that it is surjective and we conclude it is a bijection.
\item $T$ commutes with $J$ because $P-Q$ is self-adjoint. We also have $T^2P=(P-Q)^2P=P-PQP=PT^2$ and therefore the positive square root must also commute $TP=PT$. Analogously $TQ=QT$ and one concludes that $T$ and $R$ commute.
\item Since $TJP=JTP=(P-Q)P=P-QP=(1-Q)(P-Q)=(1-Q)TJ=T(1-Q)J$ and $T$ is injective we have $JP=(1-Q)J$. We also have $PJ=(J^*P^*)^*=(JP)^*=((1-Q)J)^*=J(1-Q)$ and we can solve for $JQ=(1-P)J$. We conclude $JR=J(P+Q)=(2-R)J.$
\item Since $J$ is surjective ($J^2=1$) and $1-Q$ is the projection on $\mathcal{L}^\bot$ 
\begin{equation}
J\mathcal{K}=JP\mathcal{H}=(1-Q)J\mathcal{H}=(1-Q)\mathcal{H}=\mathcal{L}^\bot.
\end{equation}
\end{enumerate}
\end{proof}

To obtain now the operators of the theory let $\mathcal{K}$ be a closed real subspace of a Hilbert space $\mathcal{H}$ such that $\mathcal{K}\cap i\mathcal{K}=\{0\}$ and $\mathcal{K}+i\mathcal{K}$ is dense in $\mathcal{H}$. Then the replacement of $\mathcal{L}$ by $i\mathcal{K}$ allows us to define the operators $P,Q,R,$ and $T$ as functions on $\mathcal{H}$. We will now give some properties of these as functions on the complex structure.  

\begin{theorem}
\begin{enumerate}[(i)]
\item $R,2-R,$ and $T$ are positive in $\mathcal{H}$
\item $J$ is a conjugate linear isometry in $\mathcal{H}$.
\item $\langle x, Jy\rangle=\langle y, Jx\rangle$ for all $x,y\in\mathcal{H}$ 
\item $(JAJ)^*=JA^*J$ for all $A\in\mathcal{B}(\mathcal{H})$
\end{enumerate}
\end{theorem}

\begin{proof}
\begin{enumerate}[(i)]
\item We only need to prove these functions are $\mathcal{B}(\mathcal{H})$. Note that for this proving linearity is enough since the topologies in the real and complex case coincide. Let $x\in\mathcal{H}$ and since $\mathcal{H}_\mathbb{R}=\mathcal{K}\oplus\mathcal{K}^\bot$ there exist unique $y\in\mathcal{K}$ and $z\in\mathcal{K}^\bot$ such that $x=y+z$. It is clear that $iz\in(i\mathcal{K})^\bot$ and therefore $iPx=iy=Q(ix)$. We conclude that $iP=Qi$ and therefore $Rix=P(ix)+Q(ix)=iQx+iPx=iRx$. We conclude that $R$ is linear. It is the clear too that $2-R$ is also linear. By uniqueness of the positive square root that $T=R^{1/2}(2-R)^{1/2}$ is also linear.
\item Given that $T$ is injective and 
\begin{align}
\begin{split}
TJ(ix)=(P-Q)(ix)=iQx-iPx=-i(P-Q)x=T(-iJx)
\end{split}
\end{align}
for all $x\in\mathcal{H}$, we conclude that $J$ is conjugate linear. Moreover, since the norm in $\mathcal{H}_\mathbb{R}$ is the same as $\mathcal{H}$ we have that $J$ is an isometry.
\item Let $x,y\in\mathcal{H}$. Then
\begin{align}
\begin{split}
\langle x,Jy\rangle &= \langle x,Jy\rangle_\mathbb{R}-i\langle x,iJy\rangle_\mathbb{R} \\
&= \langle x,Jy\rangle_\mathbb{R}-i\langle x,J(-iy)\rangle_\mathbb{R} \\
&= \langle Jx,y\rangle_\mathbb{R}-i\langle Jx,-iy\rangle_\mathbb{R} \\
&= \langle y,Jx\rangle_\mathbb{R}-i\langle -iy,Jx\rangle_\mathbb{R} \\
&= \langle y,Jx\rangle_\mathbb{R}-i\langle y,iJx\rangle_\mathbb{R} \\
&= \langle y,Jx \rangle.
\end{split}
\end{align}
\item Let $x,y\in\mathcal{H}$. Then
\begin{align}
\begin{split}
\langle x,JAJy \rangle &= \langle AJy, Jx\rangle = \langle Jy, A^*Jx\rangle \\
&= \overline{\langle A^*Jx,Jy\rangle}=\overline{\langle y, JA^*Jx\rangle} \\
&= \langle JA^*Jx,y\rangle
\end{split}
\end{align}
\end{enumerate}
We conclude that $(JAJ)^*=JA^*J$.
\end{proof}

\begin{theorem}
The spectra of $2-R$ and $R$ are equal.
\end{theorem}

\begin{proof}
We have that $J$ is a bijection and for all $\lambda\in\mathbb{C}$
\begin{equation}
J(\lambda-R)J=J\lambda J-JRJ=J^2\lambda-(2-R)J^2=\lambda-(2-R).
\end{equation}
Therefore, $\lambda-R$ is bijective if an only if $\lambda-(2-R)$ is. Moreover, by the open mapping theorem this implies that $\lambda-R$ is invertible by a bounded operator if and only if $\lambda-(2-R)$ is. We conclude $\sigma(R)=\sigma(2-R)$. 
\end{proof}

Since the spectrum of a positive operator $A\in\mathcal{B}(\mathcal{H})$ is in $[0,\infty)$ and compact and the function
\begin{align}
\begin{split}
[0,\infty)&\rightarrow \mathbb{C} \\
\lambda&\mapsto\lambda^z
\end{split}
\end{align}
(and $0^0=0$)is bounded and measurable we have that $A^z\in\mathcal{B}(\mathcal{H})$ is bounded. 

\begin{theorem}
We have that $JR^{it}J=(2-R)^{-it}.$
\end{theorem}

\begin{proof}
We have that if $P_R$ is the resolution of the identity for $R$,
\begin{align}
\begin{split}
2-R&=2\cdot1-R=2\int dP_R - \int \id_\mathbb{C}dP_R=\int 2 dP_R - \int \id_\mathbb{C}dP_R \\
&=\int (2-\id_\mathbb{C}) dP_R, 
\end{split}
\end{align}
from which we conclude $2-R=(2-\id_\mathbb{C})(R)$.
Therefore 
\begin{equation}
(2-\id_\mathbb{C})\sigma(R)=\sigma((2-\id_\mathbb{C})(R))=\sigma(2-R)=\sigma(R)
\end{equation}
and we have that $2-\id_\mathbb{C}$ is an homeomorphism from $\sigma(R)$ onto itself. We may therefore define the function
\begin{align}
\begin{split}
F:\Sigma&\rightarrow L(\mathcal{H}) \\
E&\mapsto JP_R((2-\id_\mathbb{C})(E))J
\end{split}
\end{align}
where $\Sigma$ is the Borel $\sigma$-algebra on $\sigma(R)$. We are now gonna prove this is a spectral valued measure.

Calculating we have $F(\varnothing)=JP_R(\varnothing)J=J0J=0$ and $F(\sigma(R))=JJ=1$. Let $E,D\in\Sigma$. Then
\begin{align}
\begin{split}
F(E\cap D)&=JP_R((2-id_\mathbb{C})(E\cap D))J \\
&=JP_R((2-id_\mathbb{C})(E)\cap(2-\id_\mathbb{C})(D))J \\
&=JP_R((2-id_\mathbb{C})(E))P_R((2-\id_\mathbb{C})(D))J \\
&=JP_R((2-id_\mathbb{C})(E))JJP_R((2-\id_\mathbb{C})(D))J \\
&=F(E)F(D)
\end{split}.
\end{align}
Finally, let $x,y\in\mathcal{H}$. Then for all $E\in\Sigma$
\begin{align}
\begin{split}
F_{x,y}(E)&=\langle x, F(E) y\rangle = \langle x, JP_R((2-\id_\mathbb{C})(E))Jy\rangle \\
&=\langle P_R((2-\id_\mathbb{C})(E))Jy,Jx\rangle \\
&=\langle Jy,P_R((2-\id_\mathbb{C})(E))Jx\rangle =P_{R_{Jy,Jx}}((2-\id_\mathbb{C})(E))
\end{split}
\end{align}
and we conclude $F_{x,y}=P_{R_{Jy,Jx}}\circ (2-\id_\mathbb{C})$ and since $(2-\id_\mathbb{C})$ is a bijection on $\sigma(R)$, $F_{x,y}$ is a complex measure.
Now, notice that for all $x,y\in\mathcal{H}$ we have that
\begin{align}
\begin{split}
\langle x, Ry \rangle &= \langle x, J(2-R)J y\rangle = \langle (2-R)J y, Jx \rangle \\
&= \langle Jy, (2-R)Jx \rangle = \left\langle Jy, \int (2-\id_\mathbb{C})dP_R Jx\right\rangle \\
&= \int (2-\id_\mathbb{C})dP_{R_{x,y}}
\end{split}
\end{align}
and since $2-\id_\mathbb{C}$ is a bijection,
\begin{align}
\begin{split}
\langle x, Ry\rangle &= \int (2-\id_\mathbb{C})\circ (2-\id_\mathbb{C})d(P_{R_{x,y}}\circ (2-\id_\mathbb{C})) \\
&= \int \id_\mathbb{C} d(P_{R_{x,y}}\circ (2-\id_\mathbb{C})) = \int \id_\mathbb{C} dF_{x,y}.
\end{split} \\
&= \left\langle x, \int \id_\mathbb{C} dF y\right\rangle
\end{align}
Therefore, by the uniqueness of the spectral resolution guaranteed by the spectral theorem we have that $P_R=F$. We may repeat a similar analysis to show that
\begin{align}
\begin{split}
G:\Sigma&\rightarrow L(\mathcal{H}) \\
E&\mapsto P_R((2-\id_\mathbb{C})(E))
\end{split}
\end{align}
is a resolution of the identity on $\sigma(R)$ and it is clear that $G_{x,y}=P_{R_{x,y}}\circ (2-\id_\mathbb{C})$. Notice that for all $x,y\in\mathcal{H}$
\begin{align}
\begin{split}
\langle x, (2-R) y \rangle &= \left\langle x, \int (2-\id_\mathbb{C})dP_{R}y\right\rangle = \int (2-\id_\mathbb{C})dP_{R_{x,y}} \\
&= \int (2-\id_\mathbb{C})\circ (2-\id_\mathbb{C}) d(P_{R_{x,y}}\circ (2-\id_\mathbb{C})) \\
&= \int \id_\mathbb{C} dG_{x,y},
\end{split}
\end{align}
that is, $G$ is the resolution of the identity of $2-R$.
Finally, we calculate for all $x,y\in\mathcal{H}$ and $t\in\mathbb{R}$
\begin{align}
\begin{split}
\langle x, JR^{it}J y\rangle &= \langle R^{it}Jy,Jx\rangle = \langle Jy,R^{-it}Jx\rangle \\
&= \left\langle Jy, \int \lambda^{-it}dP_R(\lambda)Jx\right\rangle = \int \lambda^{-it}dP_{R_{Jy,Jx}}(\lambda) \\
&= \int (2-\lambda)^{-it}d(P_{R_{Jy,Jx}}\circ (2-\id_\mathbb{C}))(\lambda) \\
&= \int (2-\lambda)^{-it}dF_{x,y}(\lambda) = \int (2-\lambda)^{-it}dE_{x,y}(\lambda) \\
&= \int (2-\lambda)^{-it}d(E_{x,y}\circ\id_\mathbb{C})(\lambda) \\
&= \int (2-\lambda)^{-it}d(E_{x,y}\circ (2-\id_\mathbb{C})\circ (2-\id_\mathbb{C}))(\lambda) \\
&= \int (2-\lambda)^{-it}d(G_{x,y}\circ (2-\id_\mathbb{C}))(\lambda) \\
&= \int \lambda^{-it}d(G_{x,y})(\lambda) = \langle x, (2-R)^{-it}y\rangle.
\end{split}
\end{align}
We conclude $JR^{it}J=(2-R)^{-it}$.
\end{proof}

We are now ready to define the main operator in the theory and give some of the properties which will proof to be useful in connecting the theory with KMS states.

\begin{definition}
Define the one-parameter unitary group $t\mapsto\Delta^{it} = (2-R)^{it}R^{-it}$ for all $t\in\mathbb{R}$.
\end{definition}

Note that $\Delta^{it}$ is to be understood as a symbol by its own rather than a function of an operator $\Delta$. Although such an operator $\Delta=(2-R)R^{-1}$ is usually defined, it may be unbounded and therefore the definition of $\Delta^{it}$ would require a measurable calculus for unbounded operators. Our approach using real Hilbert spaces avoided just this.

\begin{theorem}
$t\mapsto\Delta^{it}$ is a strongly continuous one-parameter unitary group which satisfies $J\Delta^{it}=\Delta^{it}J$, $T\Delta^{it}=\Delta^{it}T$, and $\Delta^{it}\mathcal{K}=\mathcal{K}$ for every $t\in\mathbb{R}$.
\end{theorem}

\begin{proof}
Using the fact that $R$ and $2-R$ commute and are self-adjoint (since they are positive) along with the properties of exponentiation prove $t\mapsto\Delta^{it}$ is a one-parameter unitary group. The fact that $T$ and $R$ commute with $R$ and $2-R$ also shows they commute with $\Delta^{it}$. Note
\begin{align}
\begin{split}
J\Delta^{it}&=J(2-R)^{it}R^{-it}=J(2-R)^{it}JJR^{-it}=R^{-it}JR^{-it} \\
&=R^{-it}JR^{-it}JJ=R^{-it}(2-R)^{it}J=(2-R)^{it} R^{-it}J=\Delta^{it}J.
\end{split}
\end{align}
The continuity property can be found in \cite{Duvenhage1999}.
\end{proof}

The connection between KMS states and Tomita-Takesaki theory follows from a certain KMS type condition that $t\mapsto\Delta^{it}$ satisfies.

\begin{definition}
Let $\mathcal{L}$ be a real subspace of $\mathcal{H}$. A one-parameter unitary group $t\mapsto U_t$ satisfies the KMS condition with respect to $\mathcal{L}$ if for all $x,y\in\mathcal{H}$ there exists a bounded continuous function $f:\overline{\mathfrak{D}_{-1}}\rightarrow\mathbb{C}$ analytic on $\mathfrak{D}_{-1}$ such that 
\begin{equation}
f(t) = \langle x, U_t y\rangle
\end{equation}
and
\begin{equation}
f(t-i)=\langle U_t y, x\rangle 
\end{equation}
for all $t\in\mathbb{R}$. 
\end{definition}

The relationship between this version of the KMS condition and the one given before will become apparent due to the connection between the inner product and the state in a GNS representation. The function $f$ in the previous definition has to be unique \cite{Duvenhage1999}. There is a useful alternative formulation of this.

\begin{theorem}
A one-parameter unitary group $t\mapsto U_t$ satisfies the KMS condition with respect to a real subspace $\mathcal{L}$ of $\mathcal{H}$ if and only if for all $x,y\in\mathcal{L}$ there exists a bounded continuous function $f:\overline{\mathfrak{D}_{-1/2}}\rightarrow\mathbb{C}$ analytic on $\mathfrak{D}_{-1/2}$ such that
\begin{equation}
f(t)=\langle x, U_t y\rangle
\end{equation}
and 
\begin{equation}
f(t-i/2)\in\mathbb{R}
\end{equation}
for all $t\in\mathbb{R}$
\end{theorem}

\begin{proof}
Let $x,y\in\mathcal{L}$. Suppose there exists a function $f:\overline{\mathfrak{D}_{-1/2}}\rightarrow\mathbb{C}$ analytic on $\mathfrak{D}_{-1/2}$ such that
\begin{equation}
f(t)=\langle x, U_t y\rangle
\end{equation}
and 
\begin{equation}
f(t-i/2)\in\mathbb{R}
\end{equation}
for all $t\in\mathbb{R}$. By the Schwarz Reflection Principle the function $g:\overline{\mathfrak{D}_{-1}}\rightarrow\mathbb{C}$ defined by 
\begin{equation}
g(z)=f(z)
\end{equation}
for all $z\in\overline{\mathfrak{D_{-1/2}}}$ and
\begin{equation}
g(z)=\overline{f(\overline{z+i/2})}
\end{equation}
for all $z\in\overline{\mathfrak{D}_{-1}}\setminus\overline{\mathfrak{D}_{-1/2}}$ is analytic on $\mathfrak{D}_{-1}$. Moreover 
\begin{equation}
g(t-i/2)=\overline{f(t)}=\langle U_t y, x \rangle
\end{equation}
for all $t\in\mathbb{R}$. The function $g$ shows that $t\mapsto U_t$ is a KMS state with respect to $\mathcal{L}$.

Assume now that $t\mapsto U_t$ satisfies the KMS condition with respect to $\mathcal{L}$ and let $f$ be a witness of this. Consider the function
\begin{align}
\begin{split}
g:\overline{\mathfrak{D}_{-1}}&\rightarrow\mathbb{C} \\
z&\mapsto\overline{f(\overline{z+i})}.
\end{split}
\end{align}
Then it is clear the $g$ is also a witness of $t\mapsto U_t$ satisfying the KMS condition with respect to $\mathcal{L}$ and by uniqueness $f=g$. But then it is clear that $f(t-i/2)\in\mathbb{R}$.
\end{proof}

To be able to prove the uniqueness of our first result stating the relation between KMS states and Tomita-Takesaki theory we need the notion of a weak entire vector.

\begin{definition}
Let $t\mapsto U_t$ be a one-parameter unitary group on $\mathcal{H}$. $x\in\mathcal{H}$ is a weak entire vector for $t\mapsto U_t$ if there exists a function $h:\mathbb{C}\rightarrow\mathcal{H}$ such that $h(t)=U_tx$ for all $t\in\mathbb{R}$, the function $z\mapsto\langle y,h(z)\rangle$ is an entire function for every $y\in\mathcal{H}$, and $h$ is bounded on every bounded subset of $i\mathbb{R}$. We denote the set of weak entire vector of $t\mapsto U_t$ by $W(U_t)$.
\end{definition}

\begin{theorem}
Let $\mathcal{L}$ be a closed real subspace of $\mathcal{H}$ and $t\mapsto U_t$ a strongly continuous one-parameter unitary group in $\mathcal{H}$ such that $U_t\mathcal{L}\subseteq\mathcal{L}$. Then $\mathcal{L}\cap W(U_t)$ is dense in $\mathcal{L}$.
\end{theorem}

\begin{proof}
Let $x\in\mathcal{L}$. Given that $\mathcal{L}$ is closed and $t\mapsto U_t$ is strongly continuous and bounded we can define the sequence $(x_n)$ in $\mathcal{L}$ where
\begin{equation}
x_n=\sqrt{\frac{n}{\pi}}\int_{-\infty}^\infty e^{-nt^2}U_t xdt.
\end{equation} 
Having in mind the standard Gaussian integral we have that $x_n\rightarrow x$ (the analysis required for this result can be found in \cite{Duvenhage1999}). Now define for every $n\in\mathbb{N}^*$ 
\begin{align}
\begin{split}
h_n:\mathbb{C}&\rightarrow\mathcal{H} \\
z &\mapsto \sqrt{\frac{n}{\pi}}\int_{-\infty}^{\infty} e^{-n(t-z)^2}U_txdt.
\end{split}
\end{align}
By the definition of a Riemann integral and continuity of the inner product 
\begin{equation}
\langle y, h_n(z)\rangle = z \sqrt{\frac{n}{\pi}}\int_{-\infty}^{\infty} e^{-n(t-z)^2}\langle y, U_tx\rangle dt.
\end{equation}
It can be shown that $z\mapsto\langle y, h_n(z)\rangle$ is an entire function (the type of argument required for this result can be found in \cite{Duvenhage1999}). By explicit calculation one can show that $h_n$ is witness of $x_n\in W(U_t)$ from which the theorem follows.
\end{proof}

We are now ready to show the key to understand the connection between KMS states and Tomita-Takesaki theory.

\begin{theorem}\label{thm:KMS_Tomita}
$t\mapsto\Delta^{it}$ is the unique strongly continuous one-parameter unitary group on $\mathcal{H}$ that satisfies the KMS condition with respect to $\mathcal{K}$ such that $\Delta^{it}\mathcal{K}\subseteq\mathcal{K}$ for all $t\in\mathbb{R}$.
\end{theorem}

\begin{proof}
We know that $t\mapsto\Delta^{it}$ is a strongly continuous one parameter unitary group. Let $x,y\in\mathcal{K}$ and 
\begin{align}
\begin{split}
f:\overline{\mathfrak{D}_{-1/2}}&\rightarrow\mathbb{C} \\
z&\mapsto \langle x, (2-R)^{iz}R^{-iz+1/2}(R^{1/2}+(2-R)^{1/2}J)y/2\rangle.
\end{split}
\end{align}
This function is continuous, bounded and analytic on $\mathfrak{D}_{-1/2}$. Let $t\in\mathbb{R}$. Then
\begin{align}
\begin{split}
f(t)&=\langle x, (2-R)^{it}R^{-it+1/2}(R^{1/2}+(2-R)^{1/2}J)y/2\rangle \\
&=\langle x ,\Delta^{it}(R+TJ)y/2\rangle = \langle x, \Delta^{it}(R+JT)y/2\rangle \\
&=\langle x, \Delta^{it}(P+Q+P-Q)y/2\rangle = \langle x, \Delta^{it}Py\rangle = \langle x, \Delta^{it}y\rangle
\end{split}
\end{align}
and 
\begin{align}\label{eq:im}
\begin{split}
\im f(t-i/2) &= \im \langle x, (2-R)^{it+1/2}R^{-it}(R^{1/2} + (2-R)^{1/2}J)y/2\rangle \\
&= \im \langle \Delta^{-it}x, (2-R)^{1/2}(R^{1/2} + (2-R)^{1/2}J)y/2\rangle \\
&= \im \langle \Delta^{-it}x, (T+(2-R)J)y/2\rangle \\
&= \im\langle \Delta^{-it}x, (T+JR)y/2\rangle \\
&= \im \langle \Delta^{-it}x, J(JT+R)y/2\rangle = \im\langle \Delta^{-it}x, JPy\rangle \\
&= \im (i\langle i\Delta^{-it}x, (1-Q)Jy\rangle) \\
&= \im (i\langle i\Delta^{-it}x, (1-Q)Jy\rangle) = 0 
\end{split}
\end{align}
since $\Delta^{-it}x\in\mathcal{K}$ and $(1-Q)Jy\in(i\mathcal{K})^\bot$. Therefore $t\mapsto\Delta^{it}$ satisfies the KMS condition with respect to $\mathcal{K}$.

Now assume that $t\mapsto U_t$ is a strongly continuous one-parameter group that satisfies the KMS condition with respect to $\mathcal{K}$ and such that $U_t\mathcal{K}\subseteq\mathcal{K}$ for all $t\in\mathbb{R}$. Let $x\in\mathcal{K}\cap W(U_t)$ and $h$ a witness of $x$ being an entire vector. We have that $h$ is bounded on all strips of the form $\{z\in\mathbb{C}|a<\im z<b\}$ with $a,b\in\mathbb{R}$ such that $a<b$. Indeed this is because the functions $z\mapsto\langle y,h(t+iz)\rangle$ and $z\mapsto\langle y, U_th(iz)\rangle$ with $y\in\mathcal{H}$ are entire and coincide on $i\mathbb{R}$. Therefore they coincide in $\mathbb{C}$ for all $y\in\mathcal{H}$ and we have
\begin{equation}
\|h(t+is)\|\leq \|U_th(is)\|\leq \|h(is)\|.
\end{equation} 
Boundedness on the strips come from $h$ being bounded on bounded subsets of $i\mathbb{R}$. Let $y\in\mathcal{K}$ and define the bounded, continuous function analytic on $\mathfrak{D}_{-1/2}$ (see \cite{Duvenhage1999})
\begin{align}
\begin{split}
g:\overline{\mathfrak{D}_{-1/2}}&\rightarrow\mathbb{C} \\
z&\mapsto\langle J(2-R)^{iz}R^{-iz+1/2}(R^{1/2}+(2-R)^{1/2}J)y/2,h(z)\rangle.
\end{split}
\end{align}
With a similar argument as the one presented in equation \eqref{eq:im} we can show that $g(\mathbb{R})\subseteq\mathbb{R}$ and 
\begin{equation}
g(t-i/2)=\langle\Delta^{it}y,h(t-i/2)\rangle.
\end{equation}
Let $f:\overline{\mathfrak{D}_{-1/2}}\rightarrow\mathbb{C}$ be a witness of $t\mapsto U_t$ satisfying the KMS condition with respect to $\mathcal{K}$ for $x$ and $\Delta^{is}y$ and define for $s\in\mathbb{R}$
\begin{align}
\begin{split}
F:\overline{\mathfrak{D}_{-1/2}}&\rightarrow\mathbb{C} \\
z&\mapsto\langle\Delta^{is}y,h(z)\rangle - f(z)
\end{split}
\end{align} 
Using the Schwarz Reflection Principle to extend $F$ and noticing that $F(\mathbb{R})=\{0\}$ we have that $F=0$. We therefore conclude that since $f(t-i/2)\in\mathbb{R}$
\begin{equation}
g(t-i/2)=\langle \Delta^{it}y,h(t-i/2)\rangle\in\mathbb{R}
\end{equation}
for all $t\in\mathbb{R}$ and $g$ is constant. In particular
\begin{equation}
\langle \Delta^{it}Jy,U_tx\rangle=g(t)=g(0)=\langle Jy,x\rangle.
\end{equation}
Given that $\Span \mathcal{K}$ is dense in $\mathcal{H}$ since $\mathcal{K}+i\mathcal{K}$ is dense we have that $\Span (\mathcal{K}\cap W(U_t))$ is dense and therefore we conclude that $\Delta^{it}Jy=U_tJy$ for all $t\in\mathbb{R}$ and $y\in\mathcal{K}$. Now, $\Span J\mathcal{K}$ is dense since $J$ is surjective, continuous, and
\begin{equation}
\mathcal{H}=J\overline{\mathcal{K}+i\mathcal{K}}\subseteq\overline{J(\mathcal{K}+i\mathcal{K})}=\overline{J\mathcal{K}+iJ\mathcal{K}}
\end{equation}.
Therefore $U_t=\Delta^{it}.$  
\end{proof}

With these we have now constructed all of the operators of the theory and stated their most important properties. Our last task for the section will be to show how the closed real subspace $\mathcal{K}$ arises in a natural fashion from a von Neumann algebra and a cyclic and separating vector.

\begin{theorem}
Let $\mathfrak{M}$ be a $W^*$-algebra on a Hilbert space $\mathcal{H}$ and $\Omega\in\mathcal{H}$ be a cyclic and separating vector for $\mathfrak{M}$. Then $\mathcal{K}=\overline{\{A\Omega|A\in\mathfrak{M}\text{ is self adjoint}\}}$ is a closed real subspace of $\mathcal{H}$ such that $\mathcal{K}\cap i\mathcal{K}=\varnothing$ and $\mathcal{K}+i\mathcal{K}$ is dense in $\mathcal{H}$.
\end{theorem}

\begin{proof}
It is clear that $\mathcal{K}$ is closed real subspace. By decomposition of bounded operators (as in the proof of theorem \ref{thm:time_invariance}) we have $\mathfrak{M}\Omega\subseteq \mathcal{K}+i\mathcal{K}$ and therefore we have that $\mathcal{K}+i\mathcal{K}$ is dense. Now let $A\in\mathfrak{M}'$ be self-adjoint. Then if $B\in\mathfrak{M}$ is self-adjoint we have that $\langle B\Omega,A\Omega\rangle\in\mathbb{R}$ and therefore $0=\langle B\Omega,iA\Omega\rangle_\mathbb{R}$. We conclude due to decomposition of bounded operators that $\mathfrak{M}'\Omega\subseteq (i\mathcal{K})^\bot+\mathcal{K}^\bot\subseteq (\mathcal{K}\cap i\mathcal{K})^\bot$. Since $\Omega$ is cyclic for $\mathfrak{M}'$ we have that $\mathcal{K}\cap i\mathcal{K}=\varnothing$.
\end{proof}

With this theorem we can define for every pair $(\mathfrak{M},\Omega)$ with $\mathfrak{M}$ a $W^*$-algebra and $\Omega$ a cyclic and separating vector for $\mathfrak{M}$ the functions $P$, $Q$, $R$, $T$, an associated unitary group $t\mapsto\Delta^{it}$, and a modular conjugation $J$. Theorem \ref{thm:GNS_von} shows that we will always be able to do Tomita-Takesaki theory on the GNS representation of a von Neumann algebra equipped with a faithful normal state. The operators of the theory behave nicely with respect to the cyclic vector $\Omega$.

\begin{theorem}
$J\Omega=\Omega$ and $\Delta^{it}\Omega=\Omega$ for all $t\in\mathbb{R}$.
\end{theorem}

\begin{proof}
It is clear that $\Omega\in\mathcal{K}\cap(i\mathcal{K})^\bot$. Therefore $P\Omega=\Omega$ and $Q\Omega = 0$. We immediately have then that $R\Omega = \Omega$ and $\Delta^{it}\Omega=\Omega$. On the other hand $T^2\Omega=\Omega$ and therefore $J\Omega = J(P-Q)\Omega=JJT\Omega = T\Omega =\Omega$.
\end{proof}

\section{Tomita-Takesaki Theorem}

This section is completely devoted to the Tomita-Takesaki theorem. Although an effort was made in the previous section to be thorough with the construction of the operators involved in the theorem, we will now only assume the result $\Delta^{it}J\mathfrak{M}'J\Delta^{-it}\subseteq \mathfrak{M}$ given in \cite{Duvenhage1999}\cite{Rieffel1977}. This is in order to keep the mathematics as concise as possible since this theorem is not easy to prove.

\begin{theorem}[Tomita-Takesaki Theorem]\label{thm:Tomita-Takesaki}
Let $\mathfrak{M}$ be a $W^*$-algebra and $\Omega$ be a cyclic and separating vector for $\mathfrak{M}$. Let $t\mapsto\Delta^{it}$ and $J$ be the unitary group and modular conjugation associated to $(\mathfrak{M},\Omega)$. Then:
\begin{enumerate}[(i)]

\item $J\mathfrak{M}J=\mathfrak{M}'$;

\item $\Delta^{it}\mathfrak{M}\Delta^{-it}=\mathfrak{M}$ for all $t\in\mathbb{R}$. 

\end{enumerate}
\end{theorem}

\begin{proof}

For all $A\in\mathfrak{M}'$ and $t\in\mathbb{R}$ we have that $\Delta^{it}JAJ\Delta{-it}\in\mathfrak{M}$ \cite{Duvenhage1999}\cite{Rieffel1977}. Then by setting $t=0$ we have that $J\mathfrak{M}'J\subseteq \mathfrak{M}$ and therefore $\mathfrak{M}'=J^2\mathfrak{M}'J^2\subseteq J\mathfrak{M}J$. On the other hand, it is clear that $\Omega\in\mathcal{K}\cap (i\mathcal{K})^\bot$. Therefore $P\Omega=\Omega$ and $Q\Omega=0$. Then $JT\Omega=\Omega$ and $T^2\Omega=\Omega$. By the Borel calculus $T^2\Omega=\Omega$ implies that $T\Omega=\Omega$\footnote{This step is not trivial. Indeed we want to prove something along the lines of: if $Ax=x$ then $f(A)x=f(1)x$. This is given in \cite{Duvenhage1999} and requires decomposing $f$ into positive functions, approximating positive functions by simple ones, simple functions by continuous ones, and continuous functions by polynomials using the Stone-Weierstrass theorem.} and we conclude $J\Omega=JJT\Omega=T\omega=\Omega$. Since $J\mathcal{K}\subseteq(i\mathcal{K})^\bot$ we have that for all $A,B\in\mathfrak{M}$ self-adjoint $\langle JA\Omega,B\Omega\rangle\in\mathbb{R}$. Therefore by the properties of $J$ we have that 

\begin{align}
\begin{split}
\langle BJAJ\Omega,\Omega\rangle&=\langle BJA\Omega,\Omega\rangle=\langle JA\Omega,B\Omega\rangle =\langle B\Omega, JA\Omega\rangle \\
&=\langle A\Omega,JB\Omega\rangle=\langle \Omega, AJB\Omega\rangle=\langle \Omega,AJBJ\Omega\rangle
\end{split}
\end{align}   

and by linearity this extends to arbitrary $B\in\mathfrak{M}$. If $C\in\mathfrak{M}'$ we have that $JCJ\in\mathfrak{M}$ since $J\mathfrak{M}'J\subseteq\mathfrak{M}$ and therefore we have for $A,B\in\mathfrak{M}$ self-adjoint recalling the properties of $J$ that
\begin{align}
\begin{split}
\langle AJBJ\Omega, C\Omega\rangle&=\langle JBJ\Omega, AC\Omega\rangle = \langle \Omega, JBJAC\Omega\rangle = \langle BJAC\Omega, J\Omega\rangle \\
&=\langle BJAC\Omega, \Omega\rangle = \langle BJCA\Omega,\Omega\rangle = \langle BJCJJA\Omega,\Omega\rangle \\
&= \langle BJCJJAJ\Omega,\Omega\rangle = \langle\Omega, AJBJCJJ\Omega\rangle = \langle\Omega, AJBJC\Omega\rangle \\
&= \langle A\Omega,JBJC\Omega\rangle=\langle JBJA\Omega,C\Omega\rangle.
\end{split}
\end{align}
Since $\Omega$ is cyclic for $\mathfrak{M}'$ by linearity we have that $JBJA\Omega=AJBJ\Omega$ for all $A,B\in\mathfrak{M}$. Therefore if $C\in\mathfrak{M}$ it is true that $JBJAC\Omega=ACJBJ\Omega=AJBJC\Omega$ and since $\Omega$ is cyclic for $\mathfrak{M}$ we have that $JBJ\in\mathfrak{M}'$ by continuity. We conclude that $J\mathfrak{M}J\subseteq\mathfrak{M}'$ proving the first part of the theorem.

For the second part note that for all $t\in\mathbb{R}$

\begin{equation}
\Delta^{it}\mathfrak{M}\Delta^{-it}=\Delta^{it}J\mathfrak{M}'J\Delta^{-it}\subseteq\mathfrak{M}
\end{equation}

and therefore

\begin{equation}
\mathfrak{M}=\Delta^0\mathfrak{M}\Delta^0=\Delta^{it}\Delta^{-it}\mathfrak{M}\Delta^{it}\Delta^{-it}\subseteq \Delta^{it}\mathfrak{M}\Delta^{-it}
\end{equation}

proving the second part.

\end{proof}

The Tomita-Takesaki theorem will be of great importance to us since it yields a one-parameter automorphism group that defines a dynamical system.

\begin{theorem}\label{thm:Dynamics_Tomita}
Let $\mathfrak{M}$ be a von Neuman algebra and $\omega$ a faithful normal state. Consider the unitary group $t\mapsto\Delta^{it}$ associated to the pair $(\pi_\omega(\mathfrak{M}),\Omega_\omega)$. Then the map
\begin{alignat}{2}
\alpha:\mathbb{R}&\rightarrow & \Aut(\mathcal{M}) \nonumber \\
t&\mapsto &\alpha_t:\mathcal{M} & \rightarrow\mathcal{M} \\
&&A&\mapsto \alpha_t(A):=\pi_\omega^{-1}(\Delta^{it}\pi_\omega(A)\Delta^{-it}). \nonumber
\end{alignat}
makes $(\mathfrak{M},\alpha)$ a $W^*$-dynamical system.
\end{theorem}

\begin{proof}
Because of theorem \ref{thm:Tomita-Takesaki} we have that $\Delta^{it}\pi_\omega(A)\Delta^{-it}\in\pi_\omega(\mathfrak{M})$ and therefore by theorem \ref{thm:GNS_von} $\alpha$ is well defined. Since $t\mapsto\Delta^{it}$ is a one-parameter unitary group and the representation is faithful it is clear that $\alpha$ is a one-parameter group of automorphisms. We have that since $t\mapsto\Delta^{it}$ is strongly continuous for all $x\in\mathcal{H}_\omega$ and $\Delta^{it}$ is unitary that $\alpha$ satisfies the correct continuity conditions and the theorem follows.
\end{proof}

\begin{definition}
The map $\alpha$ of the previous theorem is called the modular group of $(\mathfrak{M},\omega)$.
\end{definition}